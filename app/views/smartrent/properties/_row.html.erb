<div class="location">
  <% state_formatted = state.gsub(" ", "_") %>
  <div class="stateBox" id="state<%= state_formatted %>" onclick="Property.showState('<%= state %>')" style="background: url() 0% 0% repeat-x rgb(215, 218, 221);">
    <div class="state">
      <%= state %>
    </div>

    <div class="resultTotal">
      <%= property["count"] %>
    </div>

    <div class="plusMinus" id="plusMinus<%= state_formatted %>" style="font-size: 2em; background: url() 0% 0% repeat-x rgb(223, 225, 228);">
      +
    </div>

    <div class="clear"></div>
  </div>

  <div class="cities" id="cities<%= state_formatted %>">
    <div class="title" onclick="Property.toggleCities('<%= state %>');">
      <div class="text">
        Cities
      </div>

      <div class="cPlusMinus" id="citiesPlusMinus<%= state_formatted %>" style="font-size: 2em;">
        -
      </div>
      <div class="clear"></div>
    </div>
    <ul id="citiesList<%= state_formatted %>" style="display: table;">
      <% property["cities"].each do |city, count| %>
        <li>
          <a href="javascript:Property.cities('<%= state %>','<%= city %>')"><%= city %></a>
          <div class="count">
            <%= count %>
          </div>
        </li>
      <% end %>
    </ul>
  </div>

  <div class="counties" id="counties<%= state_formatted %>">
    <div class="title" onclick="Property.toggleCounties('<%= state %>');">
      <div class="text">
        Counties
      </div>

      <div class="cPlusMinus" id="countiesPlusMinus<%= state_formatted %>" style="font-size: 2em;">
        -
      </div>

      <div class="clear"></div>
    </div>

    <ul id="countiesList<%= state_formatted %>" style="display: table;">
      <% property["counties"].each do |county, count| %>
        <li>
        <a href="javascript:Property.counties('<%= state_formatted %>','<%= county %>');"><%= county %></a>
          <div class="count">
            <%= count %>
          </div>
        </li>
      <% end %>
    </ul>
  </div>
</div>
<div class="results hidden" id="results-<%= state %>">
  <% property["properties"].each do |property_| %>
  <div class="propertyListing">
    <div class="photo">
      <%= image_tag property_.image(:search_page) %>
    </div>
    <div class="info">
      <h3>
        <%= link_to property_.title, property_path(property_), :target => "_blank" %>
      </h3>

      <p><%= property_.address %>, <%= property_.city %>, <%= property_.state %><br>
      <%= property_.phone_number %></p>

      <ul class="fp">
        <% if property_.studio %>
          <li><span class="bold">Studio</span> from <%= number_to_currency property_.studio_price %></li>
        <% end %>

        <% if property_.one_bedroom %>
          <li><span class="bold">1 Bedroom</span> from <%= number_to_currency property_.one_bedroom_price %></li>
        <% end%>

        <% if property_.two_bedroom %>
          <li><span class="bold">2 Bedrooms</span> from <%= number_to_currency property_.two_bedroom_price %></li>
        <% end%>
        <% if property_.three_bedroom %>
          <li><span class="bold">3 Bedrooms</span> from <%= number_to_currency property_.three_bedroom_price %></li>
        <% end%>
        <% if property_.four_bedroom %>
          <li><span class="bold">4 Bedrooms or more</span> from <%= number_to_currency property_.four_bedroom_price %></li>
        <% end %>
        <% if property_.penthouse %>
          <li><span class="bold">Penthouses</span> from <%= number_to_currency property_.pent_house_price %></li>
        <% end %>
      </ul>

      <ul class="desc">
        <li><%= strip_tags(property_.description).truncate(100) if property_.description %></li>
      </ul>
    </div>

    <div class="learnMore">
      <h3><%= link_to "Learn More", property_path(property_) %></h3>
    </div>

    <div class="clear"></div>
  </div>
  <% end %>
</div>
